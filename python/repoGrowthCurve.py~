#!/usr/bin/python

import os
import MySQLdb as mdb

try:
	con = mdb.connect('localhost', 'root', 'root', 'github')
    cur = con.cursor()	
	sql = "SELECT DISTINCT repo_url from AllEvents LIMIT 10"
	cur.execute("SELECT followedUser_login from FollowEvents GROUP BY followedUser_login ORDER BY followedUser_followers DESC")
    rows = cur.fetchall()
    for row in rows:
    	repo_url = row[0]
    	min_sql = 'SELECT repo_watchers,timeStamp from AllEvents WHERE repo_url='+'"'+repo_url+'"'+' ORDER BY repo_watchers LIMIT 1'	
    	max_sql = 'SELECT repo_watchers,timeStamp from AllEvents WHERE repo_url='+'"'+repo_url+'"'+' ORDER BY repo_watchers DESC LIMIT 1'	
    	cur.execute(min_sql)
    	minRow = cur.fetchone(0)
    	minRepoWatchers = minRow[0]
    	minTimeStamp = minRow[1]
    	try:
			minTimeStampNew = datetime.datetime.strptime(minTimeStamp[:minTimeStamp.rfind('-')],'%Y-%m-%dT%H:%M:%S')
		except Exception as e:
			#print rawTime
			minTimeStampNew = datetime.datetime.strptime(minTimeStamp[:minTimeStamp.rfind(' ')],'%Y/%m/%d %H:%M:%S')
    	cur.execute(max_sql)
		maxRow = cur.fetchone(0)
    	maxRepoWatchers = maxRow[0]
    	maxTimeStamp = maxRow[1]
    	try:
			maxTimeStampNew = datetime.datetime.strptime(maxTimeStamp[:maxTimeStamp.rfind('-')],'%Y-%m-%dT%H:%M:%S')
		except Exception as e:
			#print rawTime
			maxTimeStampNew = datetime.datetime.strptime(maxTimeStamp[:maxTimeStamp.rfind(' ')],'%Y/%m/%d %H:%M:%S')
		watchersDelta = maxRepoWatchers - minRepoWatchers 	
		timeDelta = maxTimeStampNew = maxTimeStampNew	
    	dyBydx = watchersDelta/timeDelta.total_seconds()
    	print dyBydx
except Exception as e:
  	print e
	pass
    	
finally:
    
    if con:
        con.close()
